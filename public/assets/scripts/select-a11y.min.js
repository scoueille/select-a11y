var Select=function(){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(s.key),s)}}function l(){return(l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}var o={help:"Utilisez la tabulation (ou les touches flèches) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"Aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"Supprimer {t}",delete:"Supprimer",selectAll:"Sélectionner tout",closeButton:"Retour"},i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,a=(a=Element.prototype.closest)||function(t){var e=this;do{if(i.call(e,t))return e}while(null!==(e=e.parentElement||e.parentNode)&&1===e.nodeType);return null};return function(){function i(t,e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.el=t,this.label=document.querySelector("label[for=".concat(t.id,"]")),this.id=t.id,this.open=!1,this.preventClose=!1,this.multiple=this.el.multiple,this.search="",this.suggestions=[],this.focusIndex=null;t=l({},e),e=l(o,t.text);delete t.text,this._options=l({text:e,showSelected:!0,selectAll:!1,addCloseButton:!1},t),this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}var t,e,s;return t=i,(e=[{key:"_createButton",value:function(){var t,e=document.createElement("button"),i=(e.setAttribute("type","button"),e.setAttribute("aria-expanded",this.open),e.className="btn btn-select-a11y",document.createElement("span"));return this.multiple?i.innerText=this.label.innerText:(t=this.el.item(this.el.selectedIndex),i.innerText=t.label||t.value,this.label.id||(this.label.id="".concat(this.el.id,"-label")),e.setAttribute("id",this.el.id+"-button"),e.setAttribute("aria-labelledby",this.label.id+" "+e.id)),e.appendChild(i),e.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),e}},{key:"_createLiveZone",value:function(){var t=document.createElement("p");return t.setAttribute("aria-live","polite"),t.classList.add("sr-only"),t}},{key:"_createOverlay",value:function(){var t,e=document.createElement("div"),i=(e.classList.add("a11y-container"),document.createElement("div"));return i.classList.add("a11y-suggestions"),i.id="a11y-".concat(this.id,"-suggestions"),e.innerHTML='\n      <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n      <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n      <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage-').concat(this.id,'-js">\n    '),e.appendChild(i),this._options.addCloseButton&&((t=document.createElement("div")).setAttribute("role","button"),t.setAttribute("tabindex",0),t.classList.add("a11y-close-button"),t.innerText=this._options.text.closeButton,e.appendChild(t),this.closeButton=t),this.list=i,this.input=e.querySelector("input"),e}},{key:"_createSelectedList",value:function(){var t=document.createElement("ul");return t.className="list-inline list-selected",t}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillSuggestions",value:function(){var e,t,s=this.search.toLowerCase(),n=0,l=0;this.suggestions=Array.prototype.map.call(this.el.options,function(t,e){var i=(t.label||t.value).toLowerCase();if(n++,-1!==i.indexOf(s))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",e),i.classList.add("a11y-suggestion"),t.selected&&(l++,i.setAttribute("aria-selected","true")),i.innerText=t.label||t.value,i}.bind(this)).filter(Boolean),this.suggestions.length?((e=document.createElement("div")).setAttribute("role","listbox"),this.multiple&&e.setAttribute("aria-multiselectable","true"),this._options.selectAll&&0<n&&((t=document.createElement("div")).setAttribute("role","button"),t.setAttribute("tabindex",0),n==l?t.setAttribute("aria-pressed",1):t.setAttribute("aria-pressed",0),t.classList.add("a11y-suggestion"),t.classList.add("a11y-select-all-suggestion"),t.innerText=this._options.text.selectAll,e.appendChild(t)),this.suggestions.forEach(function(t){e.appendChild(t)}.bind(this)),this.list.innerHTML="",this.list.appendChild(e)):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this._setLiveZone()}},{key:"_handleOpener",value:function(t){this._toggleOverlay()}},{key:"_handleCloseButton",value:function(t){this._close()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){var t;this.overlay.contains(document.activeElement)||this.button===document.activeElement?document.activeElement===this.input?this.focusIndex=null:-1!==(t=this.suggestions.indexOf(document.activeElement))&&(this.focusIndex=t):this.preventClose||this._toggleOverlay(!1,document.activeElement===document.body)}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){var t;this._fillSuggestions(),this.multiple&&this._options.showSelected?this._updateSelectedList():this.multiple||(t=this.el.item(this.el.selectedIndex),this._setButtonText(t.label||t.value))}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(t){var e=a.call(t.target,'[role="option"]');if(!e)return a.call(t.target,'[role="button"]')&&this.multiple&&this._options.selectAll?void this._toggleSelectAll():void 0;t=parseInt(e.getAttribute("data-index"),10),e=!this.multiple;this._toggleSelection(t,e)}},{key:"_handleInput",value:function(){this.search!==this.input.value&&(this.search=this.input.value,this._fillSuggestions())}},{key:"_handleKeyboard",value:function(t){var e=a.call(t.target,'[role="option"]'),i=a.call(t.target,'.a11y-select-all-suggestion[role="button"]'),s=a.call(t.target,'.a11y-close-button[role="button"]'),n=a.call(t.target,"input");i?this.multiple&&this._options.selectAll&&32===t.keyCode&&this._toggleSelectAll():s?32!==t.keyCode&&13!==t.keyCode||this._toggleOverlay():27===t.keyCode?this._toggleOverlay():n&&13===t.keyCode?t.preventDefault():40===t.keyCode?(t.preventDefault(),this._moveIndex(1)):e&&(39===t.keyCode?(t.preventDefault(),this._moveIndex(1)):37===t.keyCode||38===t.keyCode?(t.preventDefault(),this._moveIndex(-1)):((this.multiple||13!==t.keyCode)&&32!==t.keyCode||(t.preventDefault(),this._toggleSelection(parseInt(e.getAttribute("data-index"),10),!this.multiple)),this.multiple&&13===t.keyCode&&!this.preventClose&&this._toggleOverlay()))}},{key:"_moveIndex",value:function(t){var e;null===this.focusIndex?this.focusIndex=0:(t=this.focusIndex+t,e=this.suggestions.length-1,this.focusIndex=e<t?0:t<0?e:t),this.suggestions[this.focusIndex].focus()}},{key:"_positionCursor",value:function(){setTimeout(function(){this.input.selectionStart=this.input.selectionEnd=this.input.value.length}.bind(this))}},{key:"_removeOption",value:function(t){var e,t=a.call(t.target,"button");t&&(e=this.selectedList.querySelectorAll("button"),e=Array.prototype.indexOf.call(e,t)-1,t=parseInt(t.getAttribute("data-index"),10),this._toggleSelection(t),(this.selectedList.parentElement?(t=this.selectedList.querySelectorAll("button"))[e]||t[0]:this.button).focus())}},{key:"_setButtonText",value:function(t){this.button.firstElementChild.innerText=t}},{key:"_setLiveZone",value:function(){var t=this.suggestions.length,e="";this.open&&(e=t?this._options.text.results.replace("{x}",t):this._options.text.noResult),this.liveZone.innerText=e}},{key:"_toggleOverlay",value:function(t,e){this.open=void 0!==t?t:!this.open,this.button.setAttribute("aria-expanded",this.open),this.open?(this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay),this.input.focus(),this.wrap.classList.add("select-a11y-opened")):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.input.value="",this.search="",this.wrap.classList.remove("select-a11y-opened"),this._setLiveZone(),void 0!==t&&!e||setTimeout(function(){this.button.focus()}.bind(this)))}},{key:"_open",value:function(){this._toggleOverlay(!0)}},{key:"_close",value:function(){this._toggleOverlay(!1)}},{key:"_preventClose",value:function(){this.preventClose=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"_toggleSelection",value:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.el.item(t);this.multiple?this.el.item(t).selected=!this.el.item(t).selected:this.el.selectedIndex=t,this.suggestions.forEach(function(t){var e=parseInt(t.getAttribute("data-index"),10);this.el.item(e).selected?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected")}.bind(this)),this.list.querySelectorAll(".a11y-select-all-suggestion").forEach(function(t){t.setAttribute("aria-pressed","false")}.bind(this)),this.multiple?this._options.showSelected&&this._updateSelectedList():this._setButtonText(i.label||i.value),e&&this.open&&this._toggleOverlay(),this.el.onchange&&this.el.onchange()}},{key:"_toggleSelectAll",value:function(){var t=this.list.querySelectorAll(".a11y-select-all-suggestion"),e=!1,i=(t.forEach(function(t){"true"==t.getAttribute("aria-pressed")&&(e=!0)}.bind(this)),0),s=0;Array.prototype.map.call(this.el.options,function(t,e){i++,t.selected&&s++}.bind(this)).filter(Boolean),s==i&&e?(Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!1}.bind(this)),this.suggestions.forEach(function(t){t.removeAttribute("aria-selected")}.bind(this)),t.forEach(function(t){t.setAttribute("aria-pressed","false")}.bind(this))):(Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!0}.bind(this)),this.suggestions.forEach(function(t){t.setAttribute("aria-selected","true")}.bind(this)),t.forEach(function(t){t.setAttribute("aria-pressed","true")}.bind(this))),this._options.showSelected&&this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_clearSelection",value:function(){var t=this.list.querySelectorAll(".a11y-select-all-suggestion");Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!1}.bind(this)),this.suggestions.forEach(function(t){t.removeAttribute("aria-selected")}.bind(this)),t.forEach(function(t){t.setAttribute("aria-pressed","false")}.bind(this)),this._options.showSelected&&this._updateSelectedList(),this.el.onchange()}},{key:"_updateSelectedList",value:function(){var t=Array.prototype.map.call(this.el.options,function(t,e){if(t.selected)return t=t.label||t.value,'\n        <li class="tag-item">\n          <span>'.concat(t,'</span>\n          <button class="tag-item-supp" title="').concat(this._options.text.deleteItem.replace("{t}",t),'" type="button" data-index="').concat(e,'">\n            <span class="sr-only">').concat(this._options.text.delete,'</span>\n            <span class="icon-delete" aria-hidden="true"></span>\n          </button>\n        </li>')}.bind(this)).filter(Boolean);this.selectedList.innerHTML=t.join(""),t.length?this.selectedList.parentElement||this.wrap.appendChild(this.selectedList):this.selectedList.parentElement&&this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var t=document.createElement("div"),e=(t.classList.add("select-a11y"),this.el.parentElement.appendChild(t),document.createElement("div"));return e.classList.add("tag-hidden"),e.setAttribute("aria-hidden",!0),this.multiple&&e.appendChild(this.label),e.appendChild(this.el),t.appendChild(e),t.appendChild(this.liveZone),t.appendChild(this.button),t}}])&&n(t.prototype,e),s&&n(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}()}();
