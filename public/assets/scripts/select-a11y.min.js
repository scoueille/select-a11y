var Select=function(){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(s.key),s)}}function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}).apply(this,arguments)}var o={help:"Utilisez la tabulation (ou les touches flèches) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"Aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"Supprimer {t}",delete:"Supprimer",selectAll:"Sélectionner tout",closeButton:"Retour"},i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,a=(a=Element.prototype.closest)||function(e){var t=this;do{if(i.call(t,e))return t}while(null!==(t=t.parentElement||t.parentNode)&&1===t.nodeType);return null};return function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.el=e,this.label=document.querySelector("label[for=".concat(e.id,"]")),this.id=e.id,this.open=!1,this.preventClose=!1,this.multiple=this.el.multiple,this.search="",this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.focusIndex=null;e=l({},t),t=l(o,e.text);delete e.text,this._options=l({text:t,showSelected:!0,selectAll:!1,addCloseButton:!1},e),this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}var e,t,s;return e=i,(t=[{key:"_createButton",value:function(){var e,t=document.createElement("button"),i=(t.setAttribute("type","button"),t.setAttribute("aria-expanded",this.open),t.className="btn btn-select-a11y",document.createElement("span"));return this.multiple?i.innerText=this.label.innerText:(e=this.el.item(this.el.selectedIndex),i.innerText=e.label||e.value,this.label.id||(this.label.id="".concat(this.el.id,"-label")),t.setAttribute("id",this.el.id+"-button"),t.setAttribute("aria-labelledby",this.label.id+" "+t.id)),t.appendChild(i),t.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),t}},{key:"_createLiveZone",value:function(){var e=document.createElement("p");return e.setAttribute("aria-live","polite"),e.classList.add("sr-only"),e}},{key:"_createOverlay",value:function(){var e,t=document.createElement("div"),i=(t.classList.add("a11y-container"),document.createElement("div"));return i.classList.add("a11y-suggestions"),i.id="a11y-".concat(this.id,"-suggestions"),t.innerHTML='\n      <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n      <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n      <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage-').concat(this.id,'-js">\n    '),t.appendChild(i),this._options.addCloseButton&&((e=document.createElement("div")).setAttribute("role","button"),e.setAttribute("tabindex",0),e.classList.add("a11y-close-button"),e.innerText=this._options.text.closeButton,t.appendChild(e),this.closeButton=e),this.list=i,this.input=t.querySelector("input"),t}},{key:"_createSelectedList",value:function(){var e=document.createElement("ul");return e.className="list-inline list-selected",e}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillSuggestions",value:function(){var t,e,o=this.search.toLowerCase(),a=0,r=0,u=-1,i=Array.prototype.map.call(this.el.querySelectorAll(":scope>option, :scope>optgroup"),function(e,t){if("option"==e.nodeName.toLowerCase()){var i=(e.label||e.value).toLowerCase();if(a++,u++,-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),e.selected&&(r++,i.setAttribute("aria-selected","true")),i.innerText=e.label||e.value,i}else{var s,n,i=e.label,l=-1!==i.toLowerCase().indexOf(o),e=e.querySelectorAll("option"),e=Array.prototype.map.call(e,function(e,t){var i=(e.label||e.value).toLowerCase();if(u++,a++,l||-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),e.selected&&(r++,i.setAttribute("aria-selected","true")),i.innerText=e.label||e.value,i}.bind(this)).filter(Boolean);if(0!=e.length)return(s=document.createElement("div")).setAttribute("role","group"),s.setAttribute("aria-labelledby",this.id+"_group_label_"+t),s.classList.add("a11y-suggestion-group"),(n=document.createElement("div")).setAttribute("role","presentation"),n.setAttribute("tabindex",0),n.setAttribute("id",this.id+"_group_label_"+t),n.classList.add("a11y-suggestion-group-label"),n.innerText=i,s.appendChild(n),e.forEach(function(e){s.appendChild(e)}.bind(this)),s}}.bind(this)).filter(Boolean),s=[],n=[];i.forEach(function(e){"option"===e.getAttribute("role")?(s.push(e),n.push(e)):"group"===e.getAttribute("role")&&(this.multiple&&e.querySelectorAll('[role="presentation"]').forEach(function(e){s.push(e),n.push(e)}),e.querySelectorAll('[role="option"]').forEach(function(e){s.push(e),n.push(e)}))}.bind(this)),this.suggestions=s,this.suggestionsGroups=[],this.suggestions.length?((t=document.createElement("div")).setAttribute("role","listbox"),this.multiple&&(t.setAttribute("aria-multiselectable","true"),this._options.selectAll)&&0<a&&((e=document.createElement("div")).setAttribute("role","button"),e.setAttribute("tabindex",0),a==r?e.setAttribute("aria-pressed",1):e.setAttribute("aria-pressed",0),e.classList.add("a11y-suggestion"),e.classList.add("a11y-select-all-suggestion"),e.innerText=this._options.text.selectAll,t.appendChild(e),n.unshift(e)),i.forEach(function(e){t.appendChild(e)}.bind(this)),this.list.innerHTML="",this.list.appendChild(t)):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this.allSuggestionsAndGroups=n,this._setLiveZone()}},{key:"_handleOpener",value:function(e){this._toggleOverlay()}},{key:"_handleCloseButton",value:function(e){this._close()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){var e;this.overlay.contains(document.activeElement)||this.button===document.activeElement?document.activeElement===this.input?this.focusIndex=null:-1!==(e=this.allSuggestionsAndGroups.indexOf(document.activeElement))&&(this.focusIndex=e):this.preventClose||this._toggleOverlay(!1,document.activeElement===document.body)}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){var e;this._fillSuggestions(),this.multiple&&this._options.showSelected?this._updateSelectedList():this.multiple||(e=this.el.item(this.el.selectedIndex),this._setButtonText(e.label||e.value))}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(e){var t=a.call(e.target,'[role="option"]');if(!t)return(i=a.call(e.target,'[role="group"]'))?void this._toggleSelectionGroup(i):a.call(e.target,'[role="button"]')&&this.multiple&&this._options.selectAll?void this._toggleSelectAll():void 0;var i=parseInt(t.getAttribute("data-index"),10),e=!this.multiple;this._toggleSelection(i,e)}},{key:"_handleInput",value:function(){this.search!==this.input.value&&(this.search=this.input.value,this._fillSuggestions())}},{key:"_handleKeyboard",value:function(e){var t=a.call(e.target,'[role="option"]'),i=a.call(e.target,'[role="group"]'),s=a.call(e.target,'.a11y-select-all-suggestion[role="button"]'),n=a.call(e.target,'.a11y-close-button[role="button"]'),l=a.call(e.target,"input");s&&this.multiple&&this._options.selectAll&&32===e.keyCode?this._toggleSelectAll():n?32!==e.keyCode&&13!==e.keyCode||this._toggleOverlay():27===e.keyCode?this._toggleOverlay():l&&13===e.keyCode?e.preventDefault():40===e.keyCode?(e.preventDefault(),this._moveIndex(1)):(t||i||s)&&(39===e.keyCode?(e.preventDefault(),this._moveIndex(1)):37===e.keyCode||38===e.keyCode?(e.preventDefault(),this._moveIndex(-1)):(t||i)&&(t&&(!this.multiple&&13===e.keyCode||32===e.keyCode)?(e.preventDefault(),this._toggleSelection(parseInt(t.getAttribute("data-index"),10),!this.multiple)):i&&this.multiple&&32===e.keyCode&&(e.preventDefault(),this._toggleSelectionGroup(i)),this.multiple)&&13===e.keyCode&&!this.preventClose&&this._toggleOverlay())}},{key:"_moveIndex",value:function(e){var t;null===this.focusIndex?this.focusIndex=0:(e=this.focusIndex+e,t=this.allSuggestionsAndGroups.length-1,this.focusIndex=t<e?0:e<0?t:e),this.allSuggestionsAndGroups[this.focusIndex].focus()}},{key:"_positionCursor",value:function(){setTimeout(function(){this.input.selectionStart=this.input.selectionEnd=this.input.value.length}.bind(this))}},{key:"_removeOption",value:function(e){var t,e=a.call(e.target,"button");e&&(t=this.selectedList.querySelectorAll("button"),t=Array.prototype.indexOf.call(t,e)-1,e=parseInt(e.getAttribute("data-index"),10),this._toggleSelection(e),(this.selectedList.parentElement?(e=this.selectedList.querySelectorAll("button"))[t]||e[0]:this.button).focus())}},{key:"_setButtonText",value:function(e){this.button.firstElementChild.innerText=e}},{key:"_setLiveZone",value:function(){var e=this.suggestions.length,t="";this.open&&(t=e?this._options.text.results.replace("{x}",e):this._options.text.noResult),this.liveZone.innerText=t}},{key:"_toggleOverlay",value:function(e,t){this.open=void 0!==e?e:!this.open,this.button.setAttribute("aria-expanded",this.open),this.open?(this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay),this.input.focus(),this.wrap.classList.add("select-a11y-opened")):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.input.value="",this.search="",this.wrap.classList.remove("select-a11y-opened"),this._setLiveZone(),void 0!==e&&!t||setTimeout(function(){this.button.focus()}.bind(this)))}},{key:"_open",value:function(){this._toggleOverlay(!0)}},{key:"_close",value:function(){this._toggleOverlay(!1)}},{key:"_preventClose",value:function(){this.preventClose=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"_toggleSelection",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.el.item(e);this.multiple?this.el.item(e).selected=!this.el.item(e).selected:this.el.selectedIndex=e,this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}.bind(this)),this.list.querySelectorAll(".a11y-select-all-suggestion").forEach(function(e){e.setAttribute("aria-pressed","false")}),this.multiple?this._options.showSelected&&this._updateSelectedList():this._setButtonText(i.label||i.value),t&&this.open&&this._toggleOverlay(),this.el.onchange&&this.el.onchange()}},{key:"_toggleSelectionGroup",value:function(t){t.querySelectorAll('[role="option"]').forEach(function(e){e=parseInt(e.getAttribute("data-index"),10);this.el.item(e);this.multiple?this.el.item(e).selected=!("true"==t.getAttribute("aria-selected")):this.el.selectedIndex=e}.bind(this)),"true"!=t.getAttribute("aria-selected")?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected"),this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}.bind(this)),this.list.querySelectorAll(".a11y-select-all-suggestion").forEach(function(e){e.setAttribute("aria-pressed","false")}),this._options.showSelected&&this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_toggleSelectAll",value:function(){var e=this.list.querySelectorAll(".a11y-select-all-suggestion"),t=!1,i=(e.forEach(function(e){"true"==e.getAttribute("aria-pressed")&&(t=!0)}.bind(this)),0),s=0;Array.prototype.map.call(this.el.options,function(e,t){i++,e.selected&&s++}.bind(this)).filter(Boolean),s==i&&t?(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach(function(e){e.removeAttribute("aria-selected")}),e.forEach(function(e){e.setAttribute("aria-pressed","false")})):(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!0}.bind(this)),this.suggestions.forEach(function(e){e.setAttribute("aria-selected","true")}),e.forEach(function(e){e.setAttribute("aria-pressed","true")})),this._options.showSelected&&this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_clearSelection",value:function(){var e=this.list.querySelectorAll(".a11y-select-all-suggestion");Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach(function(e){e.removeAttribute("aria-selected")}.bind(this)),e.forEach(function(e){e.setAttribute("aria-pressed","false")}.bind(this)),this._options.showSelected&&this._updateSelectedList(),this.el.onchange()}},{key:"_updateSelectedList",value:function(){var e=Array.prototype.map.call(this.el.options,function(e,t){if(e.selected)return e=e.label||e.value,'\n        <li class="tag-item">\n          <span>'.concat(e,'</span>\n          <button class="tag-item-supp" title="').concat(this._options.text.deleteItem.replace("{t}",e),'" type="button" data-index="').concat(t,'">\n            <span class="sr-only">').concat(this._options.text.delete,'</span>\n            <span class="icon-delete" aria-hidden="true"></span>\n          </button>\n        </li>')}.bind(this)).filter(Boolean);this.selectedList.innerHTML=e.join(""),e.length?this.selectedList.parentElement||this.wrap.appendChild(this.selectedList):this.selectedList.parentElement&&this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var e=document.createElement("div"),t=(e.classList.add("select-a11y"),this.el.parentElement.appendChild(e),document.createElement("div"));return t.classList.add("tag-hidden"),t.setAttribute("aria-hidden",!0),this.multiple&&t.appendChild(this.label),t.appendChild(this.el),e.appendChild(t),e.appendChild(this.liveZone),e.appendChild(this.button),e}}])&&n(e.prototype,t),s&&n(e,s),Object.defineProperty(e,"prototype",{writable:!1}),i}()}();
