var Select=function(){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0===i)return("string"===t?String:Number)(e);i=i.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"==typeof e?e:String(e)}(s.key),s)}}function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i,s=arguments[t];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(e[i]=s[i])}return e}).apply(this,arguments)}var i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,h=(h=Element.prototype.closest)||function(e){var t=this;do{if(i.call(t,e))return t}while(null!==(t=t.parentElement||t.parentNode)&&1===t.nodeType);return null};return function(){function i(e,t){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.el=e,this.label=document.querySelector("label[for=".concat(e.id,"]")),this.id=e.id,this.open=!1,this.multiple=this.el.multiple,this.search="",this.selectedKeywords=[],this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.focusIndex=null,this.customOverlayMessageShown=!1,this.ctrlVPressed=!1;e=l({},t),t=l({help:"Utilisez la tabulation (ou les touches flèches) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"Aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"Supprimer {t}",delete:"Supprimer",selectAll:"Sélectionner tout",closeButton:"Retour",regexErrorText:"Le mot clé est mal formaté",welcomeMessage:null},e.text);delete e.text,this._options=l({text:t,preventCloseOnSelect:!1,preventCloseOnFocusLost:!1,showSelected:!0,selectAll:!1,addCloseButton:!1,keywordsMode:!1,url:null,allowNewKeyword:!0,regexFilter:null,additionalDelemiters:[]},e),this._options.keywordsMode?(this._options.showSelected=!0,this._initialiseInputKeywords()):this._initialiseSelect()}var e,t,s;return e=i,(t=[{key:"_initialiseSelect",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_initialiseInputKeywords",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleReset=this._handleReset.bind(this),this._handleAutocompleteKeywordClick=this._handleAutocompleteKeywordClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.input=this._createKeywordInput(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleAutocompleteKeywordClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_createButton",value:function(){var e,t=document.createElement("button"),i=(t.setAttribute("type","button"),t.setAttribute("aria-expanded",this.open),t.className="btn btn-select-a11y",document.createElement("span"));return this.multiple?i.innerText=this.label.innerText:(e=this.el.item(this.el.selectedIndex),i.innerText=e.label||e.value,this.label.id||(this.label.id="".concat(this.el.id,"-label")),t.setAttribute("id",this.el.id+"-button"),t.setAttribute("aria-labelledby",this.label.id+" "+t.id)),t.appendChild(i),t.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),t}},{key:"_createKeywordInput",value:function(){var e=document.createElement("input");return e.setAttribute("type","text"),null!=this._options.url&&(e.setAttribute("role","combobox"),e.setAttribute("aria-expanded",this.open),e.setAttribute("aria-autocomplete","list")),e.className="form-control form-control-a11y",e.setAttribute("id",this.el.id+"-input"),e.setAttribute("aria-label",this.label.innerText),e.setAttribute("autocomplete","off"),e.setAttribute("spellcheck","false"),e}},{key:"_createLiveZone",value:function(){var e=document.createElement("p");return e.setAttribute("aria-live","polite"),e.classList.add("sr-only"),e}},{key:"_createOverlay",value:function(){var e,t=document.createElement("div"),i=(t.classList.add("a11y-container"),document.createElement("div"));return i.classList.add("a11y-suggestions"),i.id="a11y-".concat(this.id,"-suggestions"),this._options.keywordsMode?t.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,"</p>\n      "):t.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n        <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n        <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage-').concat(this.id,'-js">\n      '),t.appendChild(i),this._options.addCloseButton&&((e=document.createElement("div")).setAttribute("role","button"),e.setAttribute("tabindex",0),e.classList.add("a11y-close-button"),e.innerText=this._options.text.closeButton,t.appendChild(e),this.closeButton=e),this.list=i,this._options.keywordsMode||(this.input=t.querySelector("input")),t}},{key:"_createSelectedList",value:function(){var e=document.createElement("div");return e.className="list-selected",e.role="grid",e.ariaLabel="Eléments sélectionnés",e}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillOverlayWithText",value:function(e){this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.customOverlayMessageShown=!0,this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(e,"</p>"),this._setLiveZone(e)}},{key:"_fillSuggestions",value:function(){var t,e,o=this.search.toLowerCase(),r=0,a=0,u=-1,i=Array.prototype.map.call(this.el.querySelectorAll(":scope>option, :scope>optgroup"),function(e,t){if("option"==e.nodeName.toLowerCase()){var i=(e.label||e.value).toLowerCase();if(r++,u++,-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),e.selected&&(a++,i.setAttribute("aria-selected","true")),i.innerText=e.label||e.value,i}else{var s,n,i=e.label,l=-1!==i.toLowerCase().indexOf(o),e=e.querySelectorAll("option"),e=Array.prototype.map.call(e,function(e,t){var i=(e.label||e.value).toLowerCase();if(u++,r++,l||-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),e.selected&&(a++,i.setAttribute("aria-selected","true")),i.innerText=e.label||e.value,i}.bind(this)).filter(Boolean);if(0!=e.length)return(s=document.createElement("div")).setAttribute("role","group"),s.setAttribute("aria-labelledby",this.id+"_group_label_"+t),s.classList.add("a11y-suggestion-group"),(n=document.createElement("div")).setAttribute("role","presentation"),n.setAttribute("tabindex",0),n.setAttribute("id",this.id+"_group_label_"+t),n.classList.add("a11y-suggestion-group-label"),n.innerText=i,s.appendChild(n),e.forEach(function(e){s.appendChild(e)}),s}}.bind(this)).filter(Boolean),s=[],n=[],l=[];i.forEach(function(e){"option"===e.getAttribute("role")?(s.push(e),l.push(e)):"group"===e.getAttribute("role")&&(this.multiple&&e.querySelectorAll('[role="presentation"]').forEach(function(e){s.push(e),l.push(e)}),e.querySelectorAll('[role="option"]').forEach(function(e){s.push(e),l.push(e)}),n.push(e))}.bind(this)),this.suggestions=s,this.suggestionsGroups=n,this.suggestions.length?((t=document.createElement("div")).setAttribute("role","listbox"),t.id="a11y-".concat(this.id,"-listbox"),this.multiple&&(t.setAttribute("aria-multiselectable","true"),this._options.selectAll)&&0<r&&((e=document.createElement("div")).setAttribute("role","button"),e.setAttribute("tabindex",0),r==a?e.setAttribute("aria-pressed",1):e.setAttribute("aria-pressed",0),e.classList.add("a11y-suggestion"),e.classList.add("a11y-select-all-suggestion"),e.innerText=this._options.text.selectAll,t.appendChild(e),l.unshift(e)),i.forEach(function(e){t.appendChild(e)}.bind(this)),this._updateSelectedGroups(),this.list.innerHTML="",this.list.appendChild(t),this.button.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this.allSuggestionsAndGroups=l,this._setLiveZone()}},{key:"_searchParseResult",value:function(e,t){var i,s=2<arguments.length&&void 0!==arguments[2]&&arguments[2],e=Array.prototype.map.call(e[this._options.urlResultsArray],function(e){var t,i=e[this._options.urlValueField],e=e[this._options.urlLabelField];if(!this.selectedKeywords.includes(i))return(t=document.createElement("div")).setAttribute("role","option"),t.setAttribute("tabindex",0),t.setAttribute("data-value",i),t.setAttribute("data-label",e),t.classList.add("a11y-suggestion"),t.innerText=e,t}.bind(this)).filter(Boolean),n=[],l=[];e.forEach(function(e){n.push(e),l.push(e)}.bind(this)),this.suggestions=n,this.suggestionsGroups=[],this.suggestions.length?((i=document.createElement("div")).setAttribute("role","listbox"),i.id="a11y-".concat(this.id,"-listbox"),i.setAttribute("aria-multiselectable","true"),e.forEach(function(e){i.appendChild(e)}.bind(this)),this.list.innerHTML="",this.list.appendChild(i),this.input.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this.allSuggestionsAndGroups=l,this._setLiveZone(),this.suggestions.length&&s&&this._moveIndex(0)}},{key:"_fillAutocomplete",value:function(){var e,i,s=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=this.search.toLowerCase();0<n.length&&(this.ajaxRequest=new XMLHttpRequest,e=this._options.url+n,(i=this).ajaxRequest.onload=function(e){var t;null!=i.ajaxRequest&&i.ajaxRequest.responseText&&(t=JSON.parse(i.ajaxRequest.responseText),i._searchParseResult(t,n,s))},this.ajaxRequest.open("GET",e,!0),this.ajaxRequest.send()),this._setLiveZone()}},{key:"_handleOpener",value:function(e){this._toggleOverlay()}},{key:"_handleCloseButton",value:function(e){this._close()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){var e;this.overlay.contains(document.activeElement)||this.input===document.activeElement||this.button===document.activeElement?document.activeElement===this.input?this.focusIndex=null:-1!==(e=this.allSuggestionsAndGroups.indexOf(document.activeElement))&&(this.focusIndex=e):this._options.preventCloseOnFocusLost||this._toggleOverlay(!1,document.activeElement===document.body&&!this._options.keywordsMode)}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){var e;this._fillSuggestions(),this.multiple&&this._options.showSelected?this._updateSelectedList():this.multiple||(e=this.el.item(this.el.selectedIndex),this._setButtonText(e.label||e.value))}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(e){var t=h.call(e.target,'[role="option"]');if(!t)return(i=h.call(e.target,'[role="group"]'))?void this._toggleSelectionGroup(i):h.call(e.target,'[role="button"]')&&this.multiple&&this._options.selectAll?void this._toggleSelectAll():void 0;var i=parseInt(t.getAttribute("data-index"),10),e=!this.multiple;this._toggleSelection(i,e)}},{key:"_handleAutocompleteKeywordClick",value:function(e){var t,i,e=h.call(e.target,'[role="option"]');e&&(t=e.getAttribute("data-value"),i=e.getAttribute("data-label"),this._addOption(i,t),this._options.preventCloseOnSelect?this._removeSuggestion(e):this._toggleOverlay(!1))}},{key:"_handleInput",value:function(){var e,t=this;if(this.search!==this.input.value.trim()){if(this.customOverlayMessageShown&&this._toggleOverlay(!1),this.search=this.input.value.trim(),this.ctrlVPressed&&this._options.keywordsMode&&this._options.allowNewKeyword&&0<this._options.additionalDelemiters.length&&""!=this.search){for(var i=this._options.additionalDelemiters,s=null,n=null,l="",o=!0,r=0;r<this.search.length;r++)console.log("Code du caractère '"+this.search[r]+"': "+this.search.charCodeAt(r));do{s=null,i.forEach(function(e){e=t.search.indexOf(e);0<=e&&(null==s||e<s)&&(s=e)});var a,u=null,h=null}while(0<s?(u=this.search.substring(0,s).trim(),h=this.search.substring(0,s+1),this.search=this.search.substring(s+1).trim()):o||(u=this.search.trim(),h=this.search,this.search=""),u&&0<u.length&&(a=!0,(a=this._options.regexFilter?this._regexFilter(u):a)?this._addOption(u):(n=(n&&0<n.length?n+"<br />":"")+(this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(u):this._options.text.regexErrorText),l+=h)),o=!1,0<s);null!=n&&this._toggleOverlay(!0,!0,n),0<l.length&&(this.search=l+this.search),this.input.value=this.search}this._options.keywordsMode?null!=this._options.url?this.open||""==this.search?""==this.search?this._toggleOverlay(!1):this._fillAutocomplete():this._toggleOverlay(!0):this._options.regexFilter&&""!=this.search&&!this._regexFilter(this.search)&&(e=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(this.search):this._options.text.regexErrorText,this._toggleOverlay(!0,!0,e)):this._fillSuggestions()}}},{key:"_handleKeyboard",value:function(e){var t,i,s,n=h.call(e.target,'[role="option"]'),l=h.call(e.target,'[role="group"]'),o=h.call(e.target,'.a11y-select-all-suggestion[role="button"]'),r=h.call(e.target,'.a11y-close-button[role="button"]'),a=h.call(e.target,"input"),u=h.call(e.target,".tag-item");if(this.ctrlVPressed=!1,o&&this.multiple&&this._options.selectAll&&32===e.keyCode)this._toggleSelectAll();else if(r)32!==e.keyCode&&13!==e.keyCode||this._toggleOverlay();else if(u)r=h.call(e.target,".tag-item-supp"),i=h.call(e.target,'[tabindex="0"]'),s=null,r&&13===e.keyCode?this._removeOption(e):46===e.keyCode?(e.preventDefault(),r?this._removeOption(e):(t=new KeyboardEvent("keydown",e),(s=u.querySelector(".tag-item-supp")).dispatchEvent(t))):39===e.keyCode?(e.preventDefault(),r?(t=u.nextSibling)&&(s=t.querySelector("[tabindex]")):s=u.querySelector(".tag-item-supp")):37===e.keyCode?(e.preventDefault(),r?s=u.querySelector("[tabindex]"):(t=u.previousSibling)&&(s=t.querySelector(".tag-item-supp"))):40===e.keyCode?(e.preventDefault(),t=u.nextSibling,r&&t?s=t.querySelector(".tag-item-supp"):t&&(s=t.querySelector("[tabindex]"))):38===e.keyCode?(e.preventDefault(),t=u.previousSibling,r&&t?s=t.querySelector(".tag-item-supp"):t&&(s=t.querySelector("[tabindex]"))):36===e.keyCode?(e.preventDefault(),s=this.selectedList.querySelector("[tabindex]")):35===e.keyCode&&(e.preventDefault(),s=this.selectedList.lastChild.querySelector("[tabindex]")),s&&(i.setAttribute("tabindex","-1"),s.setAttribute("tabindex","0"),s.focus()),0==this.selectedList.querySelectorAll('[tabindex="0"]').length&&(this.selectedList.querySelector("[tabindex]").setAttribute("tabindex","0"),this.selectedList.querySelector("[tabindex]").focus());else if(27===e.keyCode)this._toggleOverlay();else{if(this._options.keywordsMode){if(a&&(e.ctrlKey||e.metaKey)&&"v"===e.key&&(this.ctrlVPressed=!0),a&&(13===e.keyCode||this._options.additionalDelemiters.includes(e.key))&&this._options.allowNewKeyword)return e.preventDefault(),void(""!=(u=this.input.value)&&(r=!0,(r=this._options.regexFilter?this._regexFilter(u):r)?(this._addOption(u),this.input.value=""):(t=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(u):this._options.text.regexErrorText,this._toggleOverlay(!0,!0,t))));if(a&&""!=this.input.value.trim()&&40===e.keyCode)return e.preventDefault(),void(this.open?this._moveIndex(0):this._toggleOverlay(!0,!1));if(n&&(13===e.keyCode||32===e.keyCode))return e.preventDefault(),i=n.getAttribute("data-value"),s=n.getAttribute("data-label"),this._addOption(s,i),void(this._options.preventCloseOnSelect?this._removeSuggestion(n):this._toggleOverlay(!1))}else if(a&&13===e.keyCode)return void e.preventDefault();40===e.keyCode?(e.preventDefault(),this._moveIndex(1)):(n||l||o)&&(39===e.keyCode?(e.preventDefault(),this._moveIndex(1)):37===e.keyCode||38===e.keyCode?(e.preventDefault(),this._moveIndex(-1)):(n||l)&&(n&&(!this.multiple&&13===e.keyCode||32===e.keyCode)?(e.preventDefault(),this._toggleSelection(parseInt(n.getAttribute("data-index"),10),!this.multiple)):l&&this.multiple&&32===e.keyCode&&(e.preventDefault(),this._toggleSelectionGroup(l)),this.multiple)&&13===e.keyCode&&!this._options.preventCloseOnSelect&&this._toggleOverlay())}}},{key:"_moveIndex",value:function(e){var t;0!=this.allSuggestionsAndGroups.length&&(null===this.focusIndex?this.focusIndex=0:(e=this.focusIndex+e,t=this.allSuggestionsAndGroups.length-1,this.focusIndex=t<e?0:e<0?t:e),this.allSuggestionsAndGroups[this.focusIndex].focus())}},{key:"_positionCursor",value:function(){setTimeout(function(){this.input.selectionStart=this.input.selectionEnd=this.input.value.length,this.open||null==this._options.text.welcomeMessage||this._toggleOverlay(!0,!1,this._options.text.welcomeMessage)}.bind(this))}},{key:"_removeSuggestion",value:function(e){var t=this.allSuggestionsAndGroups.length-1,i=this.allSuggestionsAndGroups.indexOf(e),s=this.suggestions.indexOf(e);t<1?(this._fillAutocomplete(),this.input.focus(),this._positionCursor()):(null==this.focusIndex||t>this.focusIndex?this._moveIndex(1):this._moveIndex(-1),-1!==i&&(this.allSuggestionsAndGroups.splice(i,1),this.suggestions.splice(s,1)),e.remove())}},{key:"_addOption",value:function(e,t){var t=t||e,i=this.el.querySelector('option[value="'+t+'"]');null!=i?i.selected=!0:this.el.add(new Option(e,t,!0,!0)),this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_removeOption",value:function(e){var t,e=h.call(e.target,'[role="button"]');e&&(t=this.selectedList.querySelectorAll('[role="button"]'),t=Array.prototype.indexOf.call(t,e)-1,e=parseInt(e.getAttribute("data-index"),10),this._toggleSelection(e),(this.selectedList.parentElement?(e=this.selectedList.querySelectorAll('[role="button"]'),this.selectedList.querySelectorAll('[tabindex="0"]').forEach(function(e){e.setAttribute("tabindex","-1")}),e[t]?(e[t].setAttribute("tabindex","0"),e[t]):(e[0].setAttribute("tabindex","0"),e[0])):this._options.keywordsMode?this.input:this.button).focus())}},{key:"_setButtonText",value:function(e){this.button.firstElementChild.innerText=e}},{key:"_setLiveZone",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t="";null!=e?t=e:(e=this.suggestions.length,this.open&&(t=e?this._options.text.results.replace("{x}",e):this._options.text.noResult)),this.liveZone.innerText=t}},{key:"_toggleOverlay",value:function(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this._options.keywordsMode&&null==this._options.url&&null==i?this.open=!1:i?this.open=void 0===e||e:(this.open=void 0!==e?e:!this.open,(this._options.keywordsMode?this.input:this.button).setAttribute("aria-expanded",this.open)),this.open?(this._options.keywordsMode?null==this._options.url&&!i||(null!=i?this._fillOverlayWithText(i):this._fillAutocomplete(!1===t),this.input.insertAdjacentElement("afterend",this.overlay)):(null!=i?this._fillOverlayWithText(i):this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay)),!1!==t&&this.input.focus(),this.wrap.classList.add("select-a11y-opened")):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.customOverlayMessageShown=!1,this._options.keywordsMode||(this.input.value="",this.search=""),this.wrap.classList.remove("select-a11y-opened"),this._setLiveZone(),void 0!==e&&!t||setTimeout(function(){(this._options.keywordsMode?this.input:this.button).focus()}.bind(this)))}},{key:"_open",value:function(){this._toggleOverlay(!0)}},{key:"_close",value:function(){this._toggleOverlay(!1)}},{key:"_preventClose",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._options.preventCloseOnFocusLost=e,this._options.preventCloseOnSelect=e}},{key:"_updateSelectedGroups",value:function(){this.suggestionsGroups.forEach(function(e){0==e.querySelectorAll('[role="option"]:not([aria-selected="true"])').length?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")})}},{key:"_toggleSelection",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=this.el.item(e),e=(this.multiple?i.selected=!i.selected:this.el.selectedIndex=e,this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}.bind(this)),this.list.querySelector(".a11y-select-all-suggestion"));e&&e.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this.multiple?this._options.showSelected&&this._updateSelectedList():this._setButtonText(i.label||i.value),t&&this.open&&this._toggleOverlay(),this.el.onchange&&this.el.onchange()}},{key:"_toggleSelectionGroup",value:function(t){t.querySelectorAll('[role="option"]').forEach(function(e){e=parseInt(e.getAttribute("data-index"),10);this.el.item(e);this.multiple?this.el.item(e).selected=!("true"==t.getAttribute("aria-selected")):this.el.selectedIndex=e}.bind(this)),this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}.bind(this)),this._updateSelectedGroups(),this.list.querySelector(".a11y-select-all-suggestion").setAttribute("aria-pressed","false"),this._options.showSelected&&this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_toggleSelectAll",value:function(){var e=this.list.querySelector(".a11y-select-all-suggestion"),t="true"==e.getAttribute("aria-pressed"),i=e.querySelectorAll('[role="option"]').length;e.querySelectorAll('[role="option"][aria-selected="true"]').length==i&&t?(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach(function(e){e.removeAttribute("aria-selected")}),e.setAttribute("aria-pressed","false")):(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!0}.bind(this)),this.suggestions.forEach(function(e){e.setAttribute("aria-selected","true")}),e.setAttribute("aria-pressed","true")),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this.el.onchange&&this.el.onchange()}},{key:"_clearSelection",value:function(){var e=this.list.querySelector(".a11y-select-all-suggestion");Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach(function(e){e.removeAttribute("aria-selected")}.bind(this)),e.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this.el.onchange()}},{key:"_updateSelectedList",value:function(){this.selectedKeywords.length=0;var e=Array.prototype.map.call(this.el.options,function(e,t){var i;if(e.selected)return i=e.label||e.value,this.selectedKeywords.push(e.value),(e=document.createElement("div")).classList.add("tag-item"),e.role="row",e.insertAdjacentHTML("beforeend",'<span role="gridcell"><span tabindex="-1" id="tag-item-'+t+'">'+i+"</span></span>"),e.insertAdjacentHTML("beforeend",'<span role="gridcell"><span class="tag-item-supp" tabindex="-1" title="'+this._options.text.deleteItem.replace("{t}",i)+'" id="tag-item-remove-'+t+'" role="button" data-index="'+t+'" aria-label="'+this._options.text.delete+'" aria-labelledby="tag-item-remove-'+t+" tag-item-"+t+'"><span class="icon-delete" aria-hidden="true"></span></span></span>'),e}.bind(this)).filter(Boolean);this.selectedList.innerHTML="",e.forEach(function(e){this.selectedList.appendChild(e)}.bind(this)),e.length?(this.selectedList.parentElement||this.wrap.appendChild(this.selectedList),this.selectedList.querySelector("[tabindex='-1']").setAttribute("tabindex","0")):this.selectedList.parentElement&&this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var e=document.createElement("div"),t=(e.classList.add("select-a11y"),this.el.parentElement.appendChild(e),document.createElement("div"));return t.classList.add("tag-hidden"),t.setAttribute("aria-hidden",!0),this.multiple&&t.appendChild(this.label),t.appendChild(this.el),e.appendChild(t),e.appendChild(this.liveZone),this._options.keywordsMode?e.appendChild(this.input):e.appendChild(this.button),e}},{key:"_regexFilter",value:function(e){var t;return!!e&&(t=this._options.regexFilter,new RegExp(t.source,"i").test(e))}},{key:"_isType",value:function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e}}])&&n(e.prototype,t),s&&n(e,s),Object.defineProperty(e,"prototype",{writable:!1}),i}()}();
