var Select=function(){"use strict";function e(e,t){for(var i=0;i<t.length;i++){var s=t[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,(n=s.key,l=void 0,"symbol"==typeof(l=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var s=i.call(e,t||"default");if("object"!=typeof s)return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(n,"string"))?l:String(l)),s)}var n,l}function t(){return t=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},t.apply(this,arguments)}var i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,s=Element.prototype.closest;s||(s=function(e){var t=this;do{if(i.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var n=function(){function i(e,s){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);this.el=e,this.label=document.querySelector("label[for=".concat(e.id,"]")),this.id=e.id,this.open=!1,this.multiple=this.el.multiple,this.search="",this.selectedKeywords=[],this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.focusIndex=null,this.customOverlayMessageShown=!1,this.ctrlVPressed=!1,this.disabled=!1;var n=t({},s),l=t({help:"Utilisez la tabulation (ou les touches flèches) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"Aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"Supprimer {t}",delete:"Supprimer",selectAll:"Sélectionner tout",closeButton:"Retour",regexErrorText:"Le mot clé est mal formaté",welcomeMessage:null},n.text);delete n.text,this._options=t({text:l,preventCloseOnSelect:!1,preventCloseOnFocusLost:!1,showSelected:!0,selectAll:!1,addCloseButton:!1,keywordsMode:!1,url:null,allowNewKeyword:!0,regexFilter:null,additionalDelemiters:[],keywordInputTemplateFunction:null,wrapTemplateFunction:null},n),this._options.keywordsMode?(this._options.showSelected=!0,this._initialiseInputKeywords()):this._initialiseSelect(),this.el.disabled&&this.disable()}var n,l,o;return n=i,l=[{key:"clearSelection",value:function(){this._clearSelection()}},{key:"setValue",value:function(e){this._clearSelection(),void 0===e||""==e||this._isType("Array",e)&&0==e.length||(this._isType("Array",e)?e:[e]).forEach(function(e){this._addOption(e)}.bind(this))}},{key:"disable",value:function(){this.disabled=!0,this.el.setAttribute("disabled",""),this._options.keywordsMode?(this.input.setAttribute("aria-disabled","true"),this.input.setAttribute("tabindex","-1"),this.input.setAttribute("disabled","")):(this.button.setAttribute("aria-disabled","true"),this.button.setAttribute("tabindex","-1"),this.button.setAttribute("disabled",""))}},{key:"enable",value:function(){this.disabled=!1,this.el.removeAttribute("disabled",""),this._options.keywordsMode?(this.input.removeAttribute("aria-disabled"),this.input.removeAttribute("tabindex"),this.input.removeAttribute("disabled")):(this.button.removeAttribute("aria-disabled"),this.button.removeAttribute("tabindex"),this.button.removeAttribute("disabled"))}},{key:"addOption",value:function(e,t){this._addOption(e,t)}},{key:"_initialiseSelect",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_initialiseInputKeywords",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleReset=this._handleReset.bind(this),this._handleAutocompleteKeywordClick=this._handleAutocompleteKeywordClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.input=this._createKeywordInput(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.ajaxRequest=null,this.selectedList.addEventListener("click",this._removeOption),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleAutocompleteKeywordClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_createButton",value:function(){var e=document.createElement("button");e.setAttribute("type","button"),e.setAttribute("aria-expanded",this.open),e.className="btn btn-select-a11y";var t=document.createElement("span");if(this.multiple&&null!=this.label)t.innerText=this.label.innerText;else{var i=this.el.item(this.el.selectedIndex);t.innerText=i.label||i.value,this.label.id||(this.label.id="".concat(this.el.id,"-label")),e.setAttribute("id",this.el.id+"-button"),e.setAttribute("aria-labelledby",this.label.id+" "+e.id)}return e.appendChild(t),e.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),e}},{key:"_createKeywordInput",value:function(){var e=document.createElement("input");return e.setAttribute("type","text"),null!=this._options.url&&(e.setAttribute("role","combobox"),e.setAttribute("aria-expanded",this.open),e.setAttribute("aria-autocomplete","list")),e.className="form-control form-control-a11y",e.setAttribute("id",this.el.id+"-input"),e.setAttribute("aria-label",null!=this.label?this.label.innerText:""),e.setAttribute("autocomplete","off"),e.setAttribute("spellcheck","false"),this._isType("Function",this._options.keywordInputTemplateFunction)?this._options.keywordInputTemplateFunction(e):e}},{key:"_createLiveZone",value:function(){var e=document.createElement("p");return e.setAttribute("aria-live","polite"),e.classList.add("sr-only"),e}},{key:"_createOverlay",value:function(){var e=document.createElement("div");e.classList.add("a11y-container"),e.setAttribute("tabindex",0);var t=document.createElement("div");if(t.classList.add("a11y-suggestions"),t.id="a11y-".concat(this.id,"-suggestions"),this._options.keywordsMode?e.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,"</p>\n      "):e.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n        <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n        <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage-').concat(this.id,'-js">\n      '),e.appendChild(t),this._options.addCloseButton){var i=document.createElement("div");i.setAttribute("role","button"),i.setAttribute("tabindex",0),i.classList.add("a11y-close-button"),i.innerText=this._options.text.closeButton,e.appendChild(i),this.closeButton=i}return this.list=t,this._options.keywordsMode||(this.input=e.querySelector("input")),e}},{key:"_createSelectedList",value:function(){var e=document.createElement("div");return e.className="list-selected",e.role="grid",e.ariaLabel="Eléments sélectionnés",e}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillOverlayWithText",value:function(e){this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.customOverlayMessageShown=!0,this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(e,"</p>"),this._setLiveZone(e)}},{key:"_fillSuggestions",value:function(){var e=this.search.toLowerCase(),t=0,i=0,s=-1,n=Array.prototype.map.call(this.el.querySelectorAll(":scope>option, :scope>optgroup"),function(n,l){if("option"==n.nodeName.toLowerCase()){var o=(n.label||n.value).toLowerCase();if(t++,s++,-1===o.indexOf(e))return;var a=document.createElement("div");return a.setAttribute("role","option"),a.setAttribute("tabindex",0),a.setAttribute("data-index",s),a.classList.add("a11y-suggestion"),n.selected&&(i++,a.setAttribute("aria-selected","true")),a.innerText=n.label||n.value,a}var r=n.label,u=-1!==r.toLowerCase().indexOf(e),h=n.querySelectorAll("option"),d=Array.prototype.map.call(h,function(n,l){var o=(n.label||n.value).toLowerCase();if(s++,t++,u||-1!==o.indexOf(e)){var a=document.createElement("div");return a.setAttribute("role","option"),a.setAttribute("tabindex",0),a.setAttribute("data-index",s),a.classList.add("a11y-suggestion"),n.selected&&(i++,a.setAttribute("aria-selected","true")),a.innerText=n.label||n.value,a}}.bind(this)).filter(Boolean);if(0!=d.length){var c=document.createElement("div");c.setAttribute("role","group"),c.setAttribute("aria-labelledby",this.id+"_group_label_"+l),c.classList.add("a11y-suggestion-group");var p=document.createElement("div");return p.setAttribute("role","presentation"),p.setAttribute("tabindex",0),p.setAttribute("id",this.id+"_group_label_"+l),p.classList.add("a11y-suggestion-group-label"),p.innerText=r,c.appendChild(p),d.forEach((function(e){c.appendChild(e)})),c}}.bind(this)).filter(Boolean),l=[],o=[],a=[];if(n.forEach(function(e){"option"===e.getAttribute("role")?(l.push(e),a.push(e)):"group"===e.getAttribute("role")&&(this.multiple&&e.querySelectorAll('[role="presentation"]').forEach((function(e){a.push(e)})),e.querySelectorAll('[role="option"]').forEach((function(e){l.push(e),a.push(e)})),o.push(e))}.bind(this)),this.suggestions=l,this.suggestionsGroups=o,this.suggestions.length){var r=document.createElement("div");if(r.setAttribute("role","listbox"),r.id="a11y-".concat(this.id,"-listbox"),this.multiple&&(r.setAttribute("aria-multiselectable","true"),this._options.selectAll&&t>0)){var u=document.createElement("div");u.setAttribute("role","button"),u.setAttribute("tabindex",0),t==i?u.setAttribute("aria-pressed",1):u.setAttribute("aria-pressed",0),u.classList.add("a11y-suggestion"),u.classList.add("a11y-select-all-suggestion"),u.innerText=this._options.text.selectAll,r.appendChild(u),a.unshift(u)}n.forEach(function(e){r.appendChild(e)}.bind(this)),this._updateSelectedGroups(),this.list.innerHTML="",this.list.appendChild(r),this.button.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))}else this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>");this.allSuggestionsAndGroups=a,this._setLiveZone()}},{key:"_searchParseResult",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=Array.prototype.map.call(e[this._options.urlResultsArray],function(e){var t=e[this._options.urlValueField],i=e[this._options.urlLabelField];if(!this.selectedKeywords.includes(t)){var s=document.createElement("div");return s.setAttribute("role","option"),s.setAttribute("tabindex",0),s.setAttribute("data-value",t),s.setAttribute("data-label",i),s.classList.add("a11y-suggestion"),s.innerText=i,s}}.bind(this)).filter(Boolean),n=[],l=[];if(s.forEach(function(e){n.push(e),l.push(e)}.bind(this)),this.suggestions=n,this.suggestionsGroups=[],this.suggestions.length){var o=document.createElement("div");o.setAttribute("role","listbox"),o.id="a11y-".concat(this.id,"-listbox"),o.setAttribute("aria-multiselectable","true"),s.forEach(function(e){o.appendChild(e)}.bind(this)),this.list.innerHTML="",this.list.appendChild(o),this.input.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))}else this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>");this.wrap.append(this.overlay),this.allSuggestionsAndGroups=l,this._setLiveZone(),this.suggestions.length&&i&&this._moveIndex(0)}},{key:"_fillAutocomplete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.search.toLowerCase();if(t.length>0){null!=this.ajaxRequest&&this.ajaxRequest.abort(),this.ajaxRequest=new XMLHttpRequest;var i=null;i=this._isType("Function",this._options.url)?this._options.url(t):this._options.url+t;var s=this;this.ajaxRequest.onload=function(i){if(null!=s.ajaxRequest&&s.ajaxRequest.responseText){var n=JSON.parse(s.ajaxRequest.responseText);s._searchParseResult(n,t,e)}},this.ajaxRequest.open("GET",i,!0),this.ajaxRequest.send()}this._setLiveZone()}},{key:"_handleOpener",value:function(e){this._toggleOverlay()}},{key:"_handleCloseButton",value:function(e){this._close()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){if(this.overlay.contains(document.activeElement)||this.input===document.activeElement||this.button===document.activeElement)if(document.activeElement===this.input)this.focusIndex=null;else{var e=this.allSuggestionsAndGroups.indexOf(document.activeElement);-1!==e&&(this.focusIndex=e)}else this._options.preventCloseOnFocusLost||(this._toggleOverlay(!1,document.activeElement===document.body&&!this._options.keywordsMode),null!=this.ajaxRequest&&this.ajaxRequest.abort())}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){if(this._fillSuggestions(),this.multiple&&this._options.showSelected)this._updateSelectedList();else if(!this.multiple){var e=this.el.item(this.el.selectedIndex);this._setButtonText(e.label||e.value)}}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(e){if(!this.disabled){var t=s.call(e.target,'[role="option"]');if(t){var i=parseInt(t.getAttribute("data-index"),10),n=!this.multiple;this._toggleSelection(i,n)}else{var l=s.call(e.target,'[role="group"]');if(!l){if(!s.call(e.target,'[role="button"]')||!this.multiple||!this._options.selectAll)return;return void this._toggleSelectAll()}this._toggleSelectionGroup(l)}}}},{key:"_handleAutocompleteKeywordClick",value:function(e){if(!this.disabled){var t=s.call(e.target,'[role="option"]');if(t){var i=t.getAttribute("data-value"),n=t.getAttribute("data-label");this._addOption(n,i),this._options.preventCloseOnSelect?this._removeSuggestion(t):this._toggleOverlay(!1)}}}},{key:"_handleInput",value:function(){var e=this;if(!this.disabled&&this.search!==this.input.value.trim()){if(this.customOverlayMessageShown&&this._toggleOverlay(!1),this.search=this.input.value.trim(),this.ctrlVPressed&&this._options.keywordsMode&&this._options.allowNewKeyword&&this._options.additionalDelemiters.length>0&&""!=this.search){var t=this._options.additionalDelemiters,i=null,s=null,n="",l=!0;do{i=null,t.forEach((function(t){var s=e.search.indexOf(t);s>=0&&(null==i||s<i)&&(i=s)}));var o=null,a=null;if(i>0?(o=this.search.substring(0,i).trim(),a=this.search.substring(0,i+1),this.search=this.search.substring(i+1).trim()):l||(o=this.search.trim(),a=this.search,this.search=""),o&&o.length>0){var r=!0;this._options.regexFilter&&(r=this._regexFilter(o)),r?this._addOption(o):(s=(s&&s.length>0?s+"<br />":"")+(this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(o):this._options.text.regexErrorText),n+=a)}l=!1}while(i>0);null!=s&&this._toggleOverlay(!0,!0,s),n.length>0&&(this.search=n+this.search),this.input.value=this.search}if(this._options.keywordsMode){if(null!=this._options.url)this.open||""==this.search?""==this.search?this._toggleOverlay(!1):this._fillAutocomplete():this._toggleOverlay(!0);else if(this._options.regexFilter&&""!=this.search&&!this._regexFilter(this.search)){var u=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(this.search):this._options.text.regexErrorText;this._toggleOverlay(!0,!0,u)}}else this._fillSuggestions()}}},{key:"_handleKeyboard",value:function(e){if(!this.disabled){var t=s.call(e.target,'[role="option"]'),i=s.call(e.target,'[role="group"]'),n=s.call(e.target,'.a11y-select-all-suggestion[role="button"]'),l=s.call(e.target,'.a11y-close-button[role="button"]'),o=s.call(e.target,"input"),a=s.call(e.target,".tag-item");if(this.ctrlVPressed=!1,n&&this.multiple&&this._options.selectAll&&32===e.keyCode)this._toggleSelectAll();else if(l)32!==e.keyCode&&13!==e.keyCode||this._toggleOverlay();else{if(a){var r=s.call(e.target,".tag-item-supp"),u=this.selectedList.querySelector('[tabindex="0"]'),h=null;if(r&&13===e.keyCode)this._removeOption(e);else if(46===e.keyCode)if(e.preventDefault(),r)this._removeOption(e);else{var d=new KeyboardEvent("keydown",e);(h=a.querySelector(".tag-item-supp")).dispatchEvent(d)}else if(39===e.keyCode)if(e.preventDefault(),r){var c=a.nextSibling;c&&(h=c.querySelector("[tabindex]"))}else h=a.querySelector(".tag-item-supp");else if(37===e.keyCode)if(e.preventDefault(),r)h=a.querySelector("[tabindex]");else{var p=a.previousSibling;p&&(h=p.querySelector(".tag-item-supp"))}else if(40===e.keyCode){e.preventDefault();var v=a.nextSibling;r&&v?h=v.querySelector(".tag-item-supp"):v&&(h=v.querySelector("[tabindex]"))}else if(38===e.keyCode){e.preventDefault();var b=a.previousSibling;r&&b?h=b.querySelector(".tag-item-supp"):b&&(h=b.querySelector("[tabindex]"))}else 36===e.keyCode?(e.preventDefault(),h=this.selectedList.querySelector("[tabindex]")):35===e.keyCode&&(e.preventDefault(),h=this.selectedList.lastChild.querySelector("[tabindex]"));return h&&(u.setAttribute("tabindex","-1"),h.setAttribute("tabindex","0"),h.focus()),void(0==this.selectedList.querySelectorAll('[tabindex="0"]').length&&(this.selectedList.querySelector("[tabindex]").setAttribute("tabindex","0"),this.selectedList.querySelector("[tabindex]").focus()))}if(27!==e.keyCode){if(this._options.keywordsMode){if(o&&(e.ctrlKey||e.metaKey)&&"v"===e.key&&(this.ctrlVPressed=!0),o&&(13===e.keyCode||this._options.additionalDelemiters.includes(e.key))&&this._options.allowNewKeyword){e.preventDefault();var g=this.input.value.trim();if(""!=g){var y=!0;if(this._options.regexFilter&&(y=this._regexFilter(g)),y)this._addOption(g),this.input.value="";else{var _=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(g):this._options.text.regexErrorText;this._toggleOverlay(!0,!0,_)}}return}if(o&&""!=this.input.value.trim()&&40===e.keyCode)return e.preventDefault(),void(this.open?this._moveIndex(0):this._toggleOverlay(!0,!1));if(t&&(13===e.keyCode||32===e.keyCode)){e.preventDefault();var f=t.getAttribute("data-value"),m=t.getAttribute("data-label");return this._addOption(m,f),void(this._options.preventCloseOnSelect?this._removeSuggestion(t):this._toggleOverlay(!1))}}else if(o&&13===e.keyCode)return void e.preventDefault();if(40===e.keyCode)return e.preventDefault(),void this._moveIndex(1);if(t||i||n)return 39===e.keyCode?(e.preventDefault(),void this._moveIndex(1)):37===e.keyCode||38===e.keyCode?(e.preventDefault(),void this._moveIndex(-1)):void((t||i)&&(t&&(!this.multiple&&13===e.keyCode||32===e.keyCode)?(e.preventDefault(),this._toggleSelection(parseInt(t.getAttribute("data-index"),10),!this.multiple)):i&&this.multiple&&32===e.keyCode&&(e.preventDefault(),this._toggleSelectionGroup(i)),this.multiple&&13===e.keyCode&&!this._options.preventCloseOnSelect&&this._toggleOverlay()))}else this._toggleOverlay()}}}},{key:"_moveIndex",value:function(e){if(!this.disabled&&0!=this.allSuggestionsAndGroups.length){if(null===this.focusIndex)this.focusIndex=0;else{var t=this.focusIndex+e,i=this.allSuggestionsAndGroups.length-1;this.focusIndex=t>i?0:t<0?i:t}this.allSuggestionsAndGroups[this.focusIndex].focus()}}},{key:"_positionCursor",value:function(){this.disabled||setTimeout(function(){this.input.selectionStart=this.input.selectionEnd=this.input.value.length,this.open||null==this._options.text.welcomeMessage||this._toggleOverlay(!0,!1,this._options.text.welcomeMessage)}.bind(this))}},{key:"_removeSuggestion",value:function(e){var t=this.allSuggestionsAndGroups.length-1,i=this.allSuggestionsAndGroups.indexOf(e),s=this.suggestions.indexOf(e);t<1?(this._close(),this.input.focus()):null==this.focusIndex||t>this.focusIndex?this._moveIndex(1):this._moveIndex(-1),-1!==i&&(this.allSuggestionsAndGroups.splice(i,1),this.suggestions.splice(s,1)),e.remove()}},{key:"_addOption",value:function(e,t){var i=t||e,s=this.el.querySelector('option[value="'+i+'"]');null!=s?(s.selected=!0,this._updateSelectedList()):(this.el.add(new Option(e,i,!0,!0)),this._updateSelectedList()),this._dispatchChangeEvent()}},{key:"_removeOption",value:function(e){var t=s.call(e.target,'[role="button"]');if(t){var i=this.selectedList.querySelectorAll('[role="button"]'),n=Array.prototype.indexOf.call(i,t)-1,l=parseInt(t.getAttribute("data-index"),10);if(this._toggleSelection(l),this.selectedList.parentElement){var o=this.selectedList.querySelectorAll('[role="button"]');this.selectedList.querySelectorAll('[tabindex="0"]').forEach((function(e){e.setAttribute("tabindex","-1")})),o[n]?(o[n].setAttribute("tabindex","0"),o[n].focus()):(o[0].setAttribute("tabindex","0"),o[0].focus())}else this._options.keywordsMode?this.input.focus():this.button.focus()}}},{key:"_setButtonText",value:function(e){this.button.firstElementChild.innerText=e}},{key:"_setLiveZone",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t="";if(null!=e)t=e;else{var i=this.suggestions.length;this.open&&(t=i?this._options.text.results.replace("{x}",i):this._options.text.noResult)}this.liveZone.innerText=t}},{key:"_toggleOverlay",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;this.disabled||(this._options.keywordsMode&&null==this._options.url&&null==i?this.open=!1:i?this.open=void 0===e||e:(this.open=void 0!==e?e:!this.open,this._options.keywordsMode?this.input.setAttribute("aria-expanded",this.open):this.button.setAttribute("aria-expanded",this.open)),this.open?(this._options.keywordsMode?(null!=this._options.url||i)&&(null!=i?(this._fillOverlayWithText(i),this.wrap.append(this.overlay)):this._fillAutocomplete(!1===t)):(null!=i?this._fillOverlayWithText(i):this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay)),!1!==t&&this.input.focus(),this.wrap.classList.add("select-a11y-opened")):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.customOverlayMessageShown=!1,this._options.keywordsMode||(this.input.value="",this.search=""),this.wrap.classList.remove("select-a11y-opened"),this._setLiveZone(),(void 0===e||t)&&setTimeout(function(){this._options.keywordsMode?this.input.focus():this.button.focus()}.bind(this))))}},{key:"_open",value:function(){this._toggleOverlay(!0)}},{key:"_close",value:function(){this._toggleOverlay(!1)}},{key:"_preventClose",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._options.preventCloseOnFocusLost=e,this._options.preventCloseOnSelect=e}},{key:"_updateSelectedGroups",value:function(){this.suggestionsGroups.forEach((function(e){0==e.querySelectorAll('[role="option"]:not([aria-selected="true"])').length?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected")}))}},{key:"_toggleSelection",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.disabled){var i=this.el.item(e);this.multiple?i.selected=!i.selected:this.el.selectedIndex=e,this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);NaN!=t&&(this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected"))}.bind(this));var s=this.list.querySelector(".a11y-select-all-suggestion");s&&s.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this.multiple?this._options.showSelected&&this._updateSelectedList():this._setButtonText(i.label||i.value),t&&this.open&&this._toggleOverlay(),this._dispatchChangeEvent()}}},{key:"_toggleSelectionGroup",value:function(e){e.querySelectorAll('[role="option"]').forEach(function(t){var i=parseInt(t.getAttribute("data-index"),10);this.el.item(i),this.multiple?this.el.item(i).selected=!("true"==e.getAttribute("aria-selected")):this.el.selectedIndex=i}.bind(this)),this.suggestions.forEach(function(e){var t=parseInt(e.getAttribute("data-index"),10);NaN!=t&&(this.el.item(t).selected?e.setAttribute("aria-selected","true"):e.removeAttribute("aria-selected"))}.bind(this)),this._updateSelectedGroups();var t=this.list.querySelector(".a11y-select-all-suggestion");t&&t.setAttribute("aria-pressed","false"),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_toggleSelectAll",value:function(){var e=this.list.querySelector(".a11y-select-all-suggestion"),t="true"==e.getAttribute("aria-pressed"),i=e.querySelectorAll('[role="option"]').length;e.querySelectorAll('[role="option"][aria-selected="true"]').length==i&&t?(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach((function(e){e.removeAttribute("aria-selected")})),e&&e.setAttribute("aria-pressed","false")):(Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!0}.bind(this)),this.suggestions.forEach((function(e){e.setAttribute("aria-selected","true")})),e&&e.setAttribute("aria-pressed","true")),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_clearSelection",value:function(){var e=this.list.querySelector(".a11y-select-all-suggestion");Array.prototype.map.call(this.el.options,function(e,t){this.el.item(t).selected=!1}.bind(this)),this.suggestions.forEach(function(e){e.removeAttribute("aria-selected")}.bind(this)),e&&e.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_updateSelectedList",value:function(){this.selectedKeywords.length=0;var e=Array.prototype.map.call(this.el.options,function(e,t){if(e.selected){var i=e.label||e.value;this.selectedKeywords.push(e.value);var s=document.createElement("div");return s.classList.add("tag-item"),s.role="row",s.insertAdjacentHTML("beforeend",'<span role="gridcell"><span tabindex="-1" id="tag-item-'+t+'">'+i+"</span></span>"),s.insertAdjacentHTML("beforeend",'<span role="gridcell"><span class="tag-item-supp" tabindex="-1" title="'+this._options.text.deleteItem.replace("{t}",i)+'" id="tag-item-remove-'+t+'" role="button" data-index="'+t+'" aria-label="'+this._options.text.delete+'" aria-labelledby="tag-item-remove-'+t+" tag-item-"+t+'"><span class="icon-delete" aria-hidden="true"></span></span></span>'),s}}.bind(this)).filter(Boolean);this.selectedList.innerHTML="",e.forEach(function(e){this.selectedList.appendChild(e)}.bind(this)),e.length?(this.selectedList.parentElement||this.wrap.appendChild(this.selectedList),this.selectedList.querySelector("[tabindex='-1']").setAttribute("tabindex","0")):this.selectedList.parentElement&&this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var e=document.createElement("div");e.classList.add("select-a11y"),this._options.keywordsMode&&e.classList.add("select-a11y-keyword"),this.el.parentElement.appendChild(e);var t=document.createElement("div");return t.classList.add("tag-hidden"),t.setAttribute("aria-hidden",!0),this.multiple&&t.appendChild(this.label),t.appendChild(this.el),e.appendChild(t),e.appendChild(this.liveZone),this._options.keywordsMode?e.appendChild(this.input):e.appendChild(this.button),this._isType("Function",this._options.wrapTemplateFunction)?this._options.wrapTemplateFunction(e,this.input.id):e}},{key:"_dispatchChangeEvent",value:function(){if(null!=this.el){var e=new Event("change",{bubbles:!0,cancelable:!0});this.el.dispatchEvent(e)}}},{key:"_regexFilter",value:function(e){if(!e)return!1;var t=this._options.regexFilter;return new RegExp(t.source,"i").test(e)}},{key:"_isType",value:function(e,t){var i=Object.prototype.toString.call(t).slice(8,-1);return null!=t&&i===e}}],l&&e(n.prototype,l),o&&e(n,o),Object.defineProperty(n,"prototype",{writable:!1}),i}();return n}();
