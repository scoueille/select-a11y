var Select=function(){"use strict";function n(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,function(t){t=function(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0===i)return("string"===e?String:Number)(t);i=i.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}(t,"string");return"symbol"==typeof t?t:String(t)}(s.key),s)}}function l(){return(l=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i,s=arguments[e];for(i in s)Object.prototype.hasOwnProperty.call(s,i)&&(t[i]=s[i])}return t}).apply(this,arguments)}var i=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,h=(h=Element.prototype.closest)||function(t){var e=this;do{if(i.call(e,t))return e}while(null!==(e=e.parentElement||e.parentNode)&&1===e.nodeType);return null};return function(){function i(t,e){if(!(this instanceof i))throw new TypeError("Cannot call a class as a function");this.el=t,this.label=document.querySelector("label[for=".concat(t.id,"]")),this.id=t.id,this.open=!1,this.multiple=this.el.multiple,this.search="",this.selectedKeywords=[],this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.focusIndex=null,this.customOverlayMessageShown=!1,this.ctrlVPressed=!1,this.disabled=!1;t=l({},e),e=l({help:"Utilisez la tabulation (ou les touches flèches) pour naviguer dans la liste des suggestions",placeholder:"Rechercher dans la liste",noResult:"Aucun résultat",results:"{x} suggestion(s) disponibles",deleteItem:"Supprimer {t}",delete:"Supprimer",selectAll:"Sélectionner tout",closeButton:"Retour",regexErrorText:"Le mot clé est mal formaté",welcomeMessage:null},t.text);delete t.text,this._options=l({text:e,preventCloseOnSelect:!1,preventCloseOnFocusLost:!1,showSelected:!0,selectAll:!1,addCloseButton:!1,keywordsMode:!1,url:null,allowNewKeyword:!0,regexFilter:null,additionalDelemiters:[],keywordInputTemplateFunction:null,wrapTemplateFunction:null},t),this._options.keywordsMode?(this._options.showSelected=!0,this._initialiseInputKeywords()):this._initialiseSelect(),this.el.disabled&&this.disable()}var t,e,s;return t=i,(e=[{key:"clearSelection",value:function(){this._clearSelection()}},{key:"setValue",value:function(t){this._clearSelection(),void 0===t||""==t||this._isType("Array",t)&&0==t.length||(this._isType("Array",t)?t:[t]).forEach(function(t){this._addOption(t)}.bind(this))}},{key:"disable",value:function(){this.disabled=!0,this.el.setAttribute("disabled",""),(this._options.keywordsMode?(this.input.setAttribute("aria-disabled","true"),this.input.setAttribute("tabindex","-1"),this.input):(this.button.setAttribute("aria-disabled","true"),this.button.setAttribute("tabindex","-1"),this.button)).setAttribute("disabled","")}},{key:"enable",value:function(){this.disabled=!1,this.el.removeAttribute("disabled",""),(this._options.keywordsMode?(this.input.removeAttribute("aria-disabled"),this.input.removeAttribute("tabindex"),this.input):(this.button.removeAttribute("aria-disabled"),this.button.removeAttribute("tabindex"),this.button)).removeAttribute("disabled")}},{key:"addOption",value:function(t,e){this._addOption(t,e)}},{key:"_initialiseSelect",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleOpener=this._handleOpener.bind(this),this._handleReset=this._handleReset.bind(this),this._handleSuggestionClick=this._handleSuggestionClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.button=this._createButton(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.multiple&&this._options.showSelected&&(this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.selectedList.addEventListener("click",this._removeOption)),this.button.addEventListener("click",this._handleOpener),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleSuggestionClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_initialiseInputKeywords",value:function(){this._handleFocus=this._handleFocus.bind(this),this._handleInput=this._handleInput.bind(this),this._handleKeyboard=this._handleKeyboard.bind(this),this._handleReset=this._handleReset.bind(this),this._handleAutocompleteKeywordClick=this._handleAutocompleteKeywordClick.bind(this),this._handleCloseButton=this._handleCloseButton.bind(this),this._positionCursor=this._positionCursor.bind(this),this._removeOption=this._removeOption.bind(this),this._disable(),this.input=this._createKeywordInput(),this.liveZone=this._createLiveZone(),this.overlay=this._createOverlay(),this.wrap=this._wrap(),this.selectedList=this._createSelectedList(),this._updateSelectedList(),this.ajaxRequest=null,this.selectedList.addEventListener("click",this._removeOption),this.input.addEventListener("input",this._handleInput),this.input.addEventListener("focus",this._positionCursor,!0),this.list.addEventListener("click",this._handleAutocompleteKeywordClick),this.wrap.addEventListener("keydown",this._handleKeyboard),document.addEventListener("blur",this._handleFocus,!0),this.closeButton&&this.closeButton.addEventListener("click",this._handleCloseButton),this.el.form.addEventListener("reset",this._handleReset)}},{key:"_createButton",value:function(){var t,e=document.createElement("button"),i=(e.setAttribute("type","button"),e.setAttribute("aria-expanded",this.open),e.className="btn btn-select-a11y",document.createElement("span"));return this.multiple&&null!=this.label?i.innerText=this.label.innerText:(t=this.el.item(this.el.selectedIndex),i.innerText=t.label||t.value,this.label.id||(this.label.id="".concat(this.el.id,"-label")),e.setAttribute("id",this.el.id+"-button"),e.setAttribute("aria-labelledby",this.label.id+" "+e.id)),e.appendChild(i),e.insertAdjacentHTML("beforeend",'<span class="icon-select" aria-hidden="true"></span>'),e}},{key:"_createKeywordInput",value:function(){var t=document.createElement("input");return t.setAttribute("type","text"),null!=this._options.url&&(t.setAttribute("role","combobox"),t.setAttribute("aria-expanded",this.open),t.setAttribute("aria-autocomplete","list")),t.className="form-control form-control-a11y",t.setAttribute("id",this.el.id+"-input"),t.setAttribute("aria-label",null!=this.label?this.label.innerText:""),t.setAttribute("autocomplete","off"),t.setAttribute("spellcheck","false"),this._isType("Function",this._options.keywordInputTemplateFunction)?this._options.keywordInputTemplateFunction(t):t}},{key:"_createLiveZone",value:function(){var t=document.createElement("p");return t.setAttribute("aria-live","polite"),t.classList.add("sr-only"),t}},{key:"_createOverlay",value:function(){var t,e=document.createElement("div"),i=(e.classList.add("a11y-container"),document.createElement("div"));return i.classList.add("a11y-suggestions"),i.id="a11y-".concat(this.id,"-suggestions"),this._options.keywordsMode?e.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,"</p>\n      "):e.innerHTML='\n        <p id="a11y-usage-'.concat(this.id,'-js" class="sr-only">').concat(this._options.text.help,'</p>\n        <label for="a11y-').concat(this.id,'-js" class="sr-only">').concat(this._options.text.placeholder,'</label>\n        <input type="text" id="a11y-').concat(this.id,'-js" class="').concat(this.el.className,'" autocomplete="off" autocapitalize="off" spellcheck="false" placeholder="').concat(this._options.text.placeholder,'" aria-describedby="a11y-usage-').concat(this.id,'-js">\n      '),e.appendChild(i),this._options.addCloseButton&&((t=document.createElement("div")).setAttribute("role","button"),t.setAttribute("tabindex",0),t.classList.add("a11y-close-button"),t.innerText=this._options.text.closeButton,e.appendChild(t),this.closeButton=t),this.list=i,this._options.keywordsMode||(this.input=e.querySelector("input")),e}},{key:"_createSelectedList",value:function(){var t=document.createElement("div");return t.className="list-selected",t.role="grid",t.ariaLabel="Eléments sélectionnés",t}},{key:"_disable",value:function(){this.el.setAttribute("tabindex",-1)}},{key:"_fillOverlayWithText",value:function(t){this.suggestions=[],this.suggestionsGroups=[],this.allSuggestionsAndGroups=[],this.customOverlayMessageShown=!0,this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(t,"</p>"),this._setLiveZone(t)}},{key:"_fillSuggestions",value:function(){var e,t,o=this.search.toLowerCase(),a=0,r=0,u=-1,i=Array.prototype.map.call(this.el.querySelectorAll(":scope>option, :scope>optgroup"),function(t,e){if("option"==t.nodeName.toLowerCase()){var i=(t.label||t.value).toLowerCase();if(a++,u++,-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),t.selected&&(r++,i.setAttribute("aria-selected","true")),i.innerText=t.label||t.value,i}else{var s,n,i=t.label,l=-1!==i.toLowerCase().indexOf(o),t=t.querySelectorAll("option"),t=Array.prototype.map.call(t,function(t,e){var i=(t.label||t.value).toLowerCase();if(u++,a++,l||-1!==i.indexOf(o))return(i=document.createElement("div")).setAttribute("role","option"),i.setAttribute("tabindex",0),i.setAttribute("data-index",u),i.classList.add("a11y-suggestion"),t.selected&&(r++,i.setAttribute("aria-selected","true")),i.innerText=t.label||t.value,i}.bind(this)).filter(Boolean);if(0!=t.length)return(s=document.createElement("div")).setAttribute("role","group"),s.setAttribute("aria-labelledby",this.id+"_group_label_"+e),s.classList.add("a11y-suggestion-group"),(n=document.createElement("div")).setAttribute("role","presentation"),n.setAttribute("tabindex",0),n.setAttribute("id",this.id+"_group_label_"+e),n.classList.add("a11y-suggestion-group-label"),n.innerText=i,s.appendChild(n),t.forEach(function(t){s.appendChild(t)}),s}}.bind(this)).filter(Boolean),s=[],n=[],l=[];i.forEach(function(t){"option"===t.getAttribute("role")?(s.push(t),l.push(t)):"group"===t.getAttribute("role")&&(this.multiple&&t.querySelectorAll('[role="presentation"]').forEach(function(t){l.push(t)}),t.querySelectorAll('[role="option"]').forEach(function(t){s.push(t),l.push(t)}),n.push(t))}.bind(this)),this.suggestions=s,this.suggestionsGroups=n,this.suggestions.length?((e=document.createElement("div")).setAttribute("role","listbox"),e.id="a11y-".concat(this.id,"-listbox"),this.multiple&&(e.setAttribute("aria-multiselectable","true"),this._options.selectAll)&&0<a&&((t=document.createElement("div")).setAttribute("role","button"),t.setAttribute("tabindex",0),a==r?t.setAttribute("aria-pressed",1):t.setAttribute("aria-pressed",0),t.classList.add("a11y-suggestion"),t.classList.add("a11y-select-all-suggestion"),t.innerText=this._options.text.selectAll,e.appendChild(t),l.unshift(t)),i.forEach(function(t){e.appendChild(t)}.bind(this)),this._updateSelectedGroups(),this.list.innerHTML="",this.list.appendChild(e),this.button.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this.allSuggestionsAndGroups=l,this._setLiveZone()}},{key:"_searchParseResult",value:function(t,e){var i,s=2<arguments.length&&void 0!==arguments[2]&&arguments[2],t=Array.prototype.map.call(t[this._options.urlResultsArray],function(t){var e,i=t[this._options.urlValueField],t=t[this._options.urlLabelField];if(!this.selectedKeywords.includes(i))return(e=document.createElement("div")).setAttribute("role","option"),e.setAttribute("tabindex",0),e.setAttribute("data-value",i),e.setAttribute("data-label",t),e.classList.add("a11y-suggestion"),e.innerText=t,e}.bind(this)).filter(Boolean),n=[],l=[];t.forEach(function(t){n.push(t),l.push(t)}.bind(this)),this.suggestions=n,this.suggestionsGroups=[],this.suggestions.length?((i=document.createElement("div")).setAttribute("role","listbox"),i.id="a11y-".concat(this.id,"-listbox"),i.setAttribute("aria-multiselectable","true"),t.forEach(function(t){i.appendChild(t)}.bind(this)),this.list.innerHTML="",this.list.appendChild(i),this.input.setAttribute("aria-controls","a11y-".concat(this.id,"-listbox"))):this.list.innerHTML='<p class="a11y-no-suggestion">'.concat(this._options.text.noResult,"</p>"),this.wrap.append(this.overlay),this.allSuggestionsAndGroups=l,this._setLiveZone(),this.suggestions.length&&s&&this._moveIndex(0)}},{key:"_fillAutocomplete",value:function(){var t,i,s=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=this.search.toLowerCase();0<n.length&&(null!=this.ajaxRequest&&this.ajaxRequest.abort(),this.ajaxRequest=new XMLHttpRequest,t=null,t=this._isType("Function",this._options.url)?this._options.url(n):this._options.url+n,(i=this).ajaxRequest.onload=function(t){var e;null!=i.ajaxRequest&&i.ajaxRequest.responseText&&(e=JSON.parse(i.ajaxRequest.responseText),i._searchParseResult(e,n,s))},this.ajaxRequest.open("GET",t,!0),this.ajaxRequest.send()),this._setLiveZone()}},{key:"_handleOpener",value:function(t){this._toggleOverlay()}},{key:"_handleCloseButton",value:function(t){this._close()}},{key:"_handleFocus",value:function(){this.open&&(clearTimeout(this._focusTimeout),this._focusTimeout=setTimeout(function(){var t;this.overlay.contains(document.activeElement)||this.input===document.activeElement||this.button===document.activeElement?document.activeElement===this.input?this.focusIndex=null:-1!==(t=this.allSuggestionsAndGroups.indexOf(document.activeElement))&&(this.focusIndex=t):this._options.preventCloseOnFocusLost||(this._toggleOverlay(!1,document.activeElement===document.body&&!this._options.keywordsMode),null!=this.ajaxRequest&&this.ajaxRequest.abort())}.bind(this),10))}},{key:"_handleReset",value:function(){clearTimeout(this._resetTimeout),this._resetTimeout=setTimeout(function(){var t;this._fillSuggestions(),this.multiple&&this._options.showSelected?this._updateSelectedList():this.multiple||(t=this.el.item(this.el.selectedIndex),this._setButtonText(t.label||t.value))}.bind(this),10)}},{key:"_handleSuggestionClick",value:function(t){var e,i;if(!this.disabled)return(e=h.call(t.target,'[role="option"]'))?(e=parseInt(e.getAttribute("data-index"),10),i=!this.multiple,void this._toggleSelection(e,i)):(e=h.call(t.target,'[role="group"]'))?void this._toggleSelectionGroup(e):h.call(t.target,'[role="button"]')&&this.multiple&&this._options.selectAll?void this._toggleSelectAll():void 0}},{key:"_handleAutocompleteKeywordClick",value:function(t){var e,i;this.disabled||(t=h.call(t.target,'[role="option"]'))&&(e=t.getAttribute("data-value"),i=t.getAttribute("data-label"),this._addOption(i,e),this._options.preventCloseOnSelect?this._removeSuggestion(t):this._toggleOverlay(!1))}},{key:"_handleInput",value:function(){var t,e=this;if(!this.disabled&&this.search!==this.input.value.trim()){if(this.customOverlayMessageShown&&this._toggleOverlay(!1),this.search=this.input.value.trim(),this.ctrlVPressed&&this._options.keywordsMode&&this._options.allowNewKeyword&&0<this._options.additionalDelemiters.length&&""!=this.search){var i=this._options.additionalDelemiters,s=null,n=null,l="",o=!0;do{s=null,i.forEach(function(t){t=e.search.indexOf(t);0<=t&&(null==s||t<s)&&(s=t)});var a,r=null,u=null}while(0<s?(r=this.search.substring(0,s).trim(),u=this.search.substring(0,s+1),this.search=this.search.substring(s+1).trim()):o||(r=this.search.trim(),u=this.search,this.search=""),r&&0<r.length&&(a=!0,(a=this._options.regexFilter?this._regexFilter(r):a)?this._addOption(r):(n=(n&&0<n.length?n+"<br />":"")+(this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(r):this._options.text.regexErrorText),l+=u)),o=!1,0<s);null!=n&&this._toggleOverlay(!0,!0,n),0<l.length&&(this.search=l+this.search),this.input.value=this.search}this._options.keywordsMode?null!=this._options.url?this.open||""==this.search?""==this.search?this._toggleOverlay(!1):this._fillAutocomplete():this._toggleOverlay(!0):this._options.regexFilter&&""!=this.search&&!this._regexFilter(this.search)&&(t=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(this.search):this._options.text.regexErrorText,this._toggleOverlay(!0,!0,t)):this._fillSuggestions()}}},{key:"_handleKeyboard",value:function(t){if(!this.disabled){var e,i,s,n=h.call(t.target,'[role="option"]'),l=h.call(t.target,'[role="group"]'),o=h.call(t.target,'.a11y-select-all-suggestion[role="button"]'),a=h.call(t.target,'.a11y-close-button[role="button"]'),r=h.call(t.target,"input"),u=h.call(t.target,".tag-item");if(this.ctrlVPressed=!1,o&&this.multiple&&this._options.selectAll&&32===t.keyCode)this._toggleSelectAll();else if(a)32!==t.keyCode&&13!==t.keyCode||this._toggleOverlay();else if(u)a=h.call(t.target,".tag-item-supp"),i=h.call(t.target,'[tabindex="0"]'),s=null,a&&13===t.keyCode?this._removeOption(t):46===t.keyCode?(t.preventDefault(),a?this._removeOption(t):(e=new KeyboardEvent("keydown",t),(s=u.querySelector(".tag-item-supp")).dispatchEvent(e))):39===t.keyCode?(t.preventDefault(),a?(e=u.nextSibling)&&(s=e.querySelector("[tabindex]")):s=u.querySelector(".tag-item-supp")):37===t.keyCode?(t.preventDefault(),a?s=u.querySelector("[tabindex]"):(e=u.previousSibling)&&(s=e.querySelector(".tag-item-supp"))):40===t.keyCode?(t.preventDefault(),e=u.nextSibling,a&&e?s=e.querySelector(".tag-item-supp"):e&&(s=e.querySelector("[tabindex]"))):38===t.keyCode?(t.preventDefault(),e=u.previousSibling,a&&e?s=e.querySelector(".tag-item-supp"):e&&(s=e.querySelector("[tabindex]"))):36===t.keyCode?(t.preventDefault(),s=this.selectedList.querySelector("[tabindex]")):35===t.keyCode&&(t.preventDefault(),s=this.selectedList.lastChild.querySelector("[tabindex]")),s&&(i.setAttribute("tabindex","-1"),s.setAttribute("tabindex","0"),s.focus()),0==this.selectedList.querySelectorAll('[tabindex="0"]').length&&(this.selectedList.querySelector("[tabindex]").setAttribute("tabindex","0"),this.selectedList.querySelector("[tabindex]").focus());else if(27===t.keyCode)this._toggleOverlay();else{if(this._options.keywordsMode){if(r&&(t.ctrlKey||t.metaKey)&&"v"===t.key&&(this.ctrlVPressed=!0),r&&(13===t.keyCode||this._options.additionalDelemiters.includes(t.key))&&this._options.allowNewKeyword)return t.preventDefault(),void(""!=(u=this.input.value)&&(a=!0,(a=this._options.regexFilter?this._regexFilter(u):a)?(this._addOption(u),this.input.value=""):(e=this._isType("Function",this._options.text.regexErrorText)?this._options.text.regexErrorText(u):this._options.text.regexErrorText,this._toggleOverlay(!0,!0,e))));if(r&&""!=this.input.value.trim()&&40===t.keyCode)return t.preventDefault(),void(this.open?this._moveIndex(0):this._toggleOverlay(!0,!1));if(n&&(13===t.keyCode||32===t.keyCode))return t.preventDefault(),i=n.getAttribute("data-value"),s=n.getAttribute("data-label"),this._addOption(s,i),void(this._options.preventCloseOnSelect?this._removeSuggestion(n):this._toggleOverlay(!1))}else if(r&&13===t.keyCode)return void t.preventDefault();40===t.keyCode?(t.preventDefault(),this._moveIndex(1)):(n||l||o)&&(39===t.keyCode?(t.preventDefault(),this._moveIndex(1)):37===t.keyCode||38===t.keyCode?(t.preventDefault(),this._moveIndex(-1)):(n||l)&&(n&&(!this.multiple&&13===t.keyCode||32===t.keyCode)?(t.preventDefault(),this._toggleSelection(parseInt(n.getAttribute("data-index"),10),!this.multiple)):l&&this.multiple&&32===t.keyCode&&(t.preventDefault(),this._toggleSelectionGroup(l)),this.multiple)&&13===t.keyCode&&!this._options.preventCloseOnSelect&&this._toggleOverlay())}}}},{key:"_moveIndex",value:function(t){var e;this.disabled||0!=this.allSuggestionsAndGroups.length&&(null===this.focusIndex?this.focusIndex=0:(t=this.focusIndex+t,e=this.allSuggestionsAndGroups.length-1,this.focusIndex=e<t?0:t<0?e:t),this.allSuggestionsAndGroups[this.focusIndex].focus())}},{key:"_positionCursor",value:function(){this.disabled||setTimeout(function(){this.input.selectionStart=this.input.selectionEnd=this.input.value.length,this.open||null==this._options.text.welcomeMessage||this._toggleOverlay(!0,!1,this._options.text.welcomeMessage)}.bind(this))}},{key:"_removeSuggestion",value:function(t){var e=this.allSuggestionsAndGroups.length-1,i=this.allSuggestionsAndGroups.indexOf(t),s=this.suggestions.indexOf(t);e<1?(this._fillAutocomplete(),this.input.focus(),this._positionCursor()):(null==this.focusIndex||e>this.focusIndex?this._moveIndex(1):this._moveIndex(-1),-1!==i&&(this.allSuggestionsAndGroups.splice(i,1),this.suggestions.splice(s,1)),t.remove())}},{key:"_addOption",value:function(t,e){var e=e||t,i=this.el.querySelector('option[value="'+e+'"]');null!=i?i.selected=!0:this.el.add(new Option(t,e,!0,!0)),this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_removeOption",value:function(t){var e,t=h.call(t.target,'[role="button"]');t&&(e=this.selectedList.querySelectorAll('[role="button"]'),e=Array.prototype.indexOf.call(e,t)-1,t=parseInt(t.getAttribute("data-index"),10),this._toggleSelection(t),(this.selectedList.parentElement?(t=this.selectedList.querySelectorAll('[role="button"]'),this.selectedList.querySelectorAll('[tabindex="0"]').forEach(function(t){t.setAttribute("tabindex","-1")}),t[e]?(t[e].setAttribute("tabindex","0"),t[e]):(t[0].setAttribute("tabindex","0"),t[0])):this._options.keywordsMode?this.input:this.button).focus())}},{key:"_setButtonText",value:function(t){this.button.firstElementChild.innerText=t}},{key:"_setLiveZone",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e="";null!=t?e=t:(t=this.suggestions.length,this.open&&(e=t?this._options.text.results.replace("{x}",t):this._options.text.noResult)),this.liveZone.innerText=e}},{key:"_toggleOverlay",value:function(t,e){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.disabled||(this._options.keywordsMode&&null==this._options.url&&null==i?this.open=!1:i?this.open=void 0===t||t:(this.open=void 0!==t?t:!this.open,(this._options.keywordsMode?this.input:this.button).setAttribute("aria-expanded",this.open)),this.open?(this._options.keywordsMode?null==this._options.url&&!i||(null!=i?(this._fillOverlayWithText(i),this.wrap.append(this.overlay)):this._fillAutocomplete(!1===e)):(null!=i?this._fillOverlayWithText(i):this._fillSuggestions(),this.button.insertAdjacentElement("afterend",this.overlay)),!1!==e&&this.input.focus(),this.wrap.classList.add("select-a11y-opened")):this.wrap.contains(this.overlay)&&(this.wrap.removeChild(this.overlay),this.focusIndex=null,this.customOverlayMessageShown=!1,this._options.keywordsMode||(this.input.value="",this.search=""),this.wrap.classList.remove("select-a11y-opened"),this._setLiveZone(),void 0!==t&&!e||setTimeout(function(){(this._options.keywordsMode?this.input:this.button).focus()}.bind(this))))}},{key:"_open",value:function(){this._toggleOverlay(!0)}},{key:"_close",value:function(){this._toggleOverlay(!1)}},{key:"_preventClose",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._options.preventCloseOnFocusLost=t,this._options.preventCloseOnSelect=t}},{key:"_updateSelectedGroups",value:function(){this.suggestionsGroups.forEach(function(t){0==t.querySelectorAll('[role="option"]:not([aria-selected="true"])').length?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected")})}},{key:"_toggleSelection",value:function(t){var e,i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];this.disabled||(e=this.el.item(t),this.multiple?e.selected=!e.selected:this.el.selectedIndex=t,this.suggestions.forEach(function(t){var e=parseInt(t.getAttribute("data-index"),10);NaN!=e&&(this.el.item(e).selected?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected"))}.bind(this)),(t=this.list.querySelector(".a11y-select-all-suggestion"))&&t.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this.multiple?this._options.showSelected&&this._updateSelectedList():this._setButtonText(e.label||e.value),i&&this.open&&this._toggleOverlay(),this._dispatchChangeEvent())}},{key:"_toggleSelectionGroup",value:function(e){e.querySelectorAll('[role="option"]').forEach(function(t){t=parseInt(t.getAttribute("data-index"),10);this.el.item(t);this.multiple?this.el.item(t).selected=!("true"==e.getAttribute("aria-selected")):this.el.selectedIndex=t}.bind(this)),this.suggestions.forEach(function(t){var e=parseInt(t.getAttribute("data-index"),10);NaN!=e&&(this.el.item(e).selected?t.setAttribute("aria-selected","true"):t.removeAttribute("aria-selected"))}.bind(this)),this._updateSelectedGroups();var t=this.list.querySelector(".a11y-select-all-suggestion");t&&t.setAttribute("aria-pressed","false"),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_toggleSelectAll",value:function(){var t=this.list.querySelector(".a11y-select-all-suggestion"),e="true"==t.getAttribute("aria-pressed"),i=t.querySelectorAll('[role="option"]').length;t.querySelectorAll('[role="option"][aria-selected="true"]').length==i&&e?(Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!1}.bind(this)),this.suggestions.forEach(function(t){t.removeAttribute("aria-selected")}),t&&t.setAttribute("aria-pressed","false")):(Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!0}.bind(this)),this.suggestions.forEach(function(t){t.setAttribute("aria-selected","true")}),t&&t.setAttribute("aria-pressed","true")),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_clearSelection",value:function(){var t=this.list.querySelector(".a11y-select-all-suggestion");Array.prototype.map.call(this.el.options,function(t,e){this.el.item(e).selected=!1}.bind(this)),this.suggestions.forEach(function(t){t.removeAttribute("aria-selected")}.bind(this)),t&&t.setAttribute("aria-pressed","false"),this._updateSelectedGroups(),this._options.showSelected&&this._updateSelectedList(),this._dispatchChangeEvent()}},{key:"_updateSelectedList",value:function(){this.selectedKeywords.length=0;var t=Array.prototype.map.call(this.el.options,function(t,e){var i;if(t.selected)return i=t.label||t.value,this.selectedKeywords.push(t.value),(t=document.createElement("div")).classList.add("tag-item"),t.role="row",t.insertAdjacentHTML("beforeend",'<span role="gridcell"><span tabindex="-1" id="tag-item-'+e+'">'+i+"</span></span>"),t.insertAdjacentHTML("beforeend",'<span role="gridcell"><span class="tag-item-supp" tabindex="-1" title="'+this._options.text.deleteItem.replace("{t}",i)+'" id="tag-item-remove-'+e+'" role="button" data-index="'+e+'" aria-label="'+this._options.text.delete+'" aria-labelledby="tag-item-remove-'+e+" tag-item-"+e+'"><span class="icon-delete" aria-hidden="true"></span></span></span>'),t}.bind(this)).filter(Boolean);this.selectedList.innerHTML="",t.forEach(function(t){this.selectedList.appendChild(t)}.bind(this)),t.length?(this.selectedList.parentElement||this.wrap.appendChild(this.selectedList),this.selectedList.querySelector("[tabindex='-1']").setAttribute("tabindex","0")):this.selectedList.parentElement&&this.wrap.removeChild(this.selectedList)}},{key:"_wrap",value:function(){var t=document.createElement("div"),e=(t.classList.add("select-a11y"),this._options.keywordsMode&&t.classList.add("select-a11y-keyword"),this.el.parentElement.appendChild(t),document.createElement("div"));return e.classList.add("tag-hidden"),e.setAttribute("aria-hidden",!0),this.multiple&&e.appendChild(this.label),e.appendChild(this.el),t.appendChild(e),t.appendChild(this.liveZone),this._options.keywordsMode?t.appendChild(this.input):t.appendChild(this.button),this._isType("Function",this._options.wrapTemplateFunction)?this._options.wrapTemplateFunction(t,this.input.id):t}},{key:"_dispatchChangeEvent",value:function(){var t;null!=this.el&&(t=new Event("change",{bubbles:!0,cancelable:!0}),this.el.dispatchEvent(t))}},{key:"_regexFilter",value:function(t){var e;return!!t&&(e=this._options.regexFilter,new RegExp(e.source,"i").test(t))}},{key:"_isType",value:function(t,e){var i=Object.prototype.toString.call(e).slice(8,-1);return null!=e&&i===t}}])&&n(t.prototype,e),s&&n(t,s),Object.defineProperty(t,"prototype",{writable:!1}),i}()}();
